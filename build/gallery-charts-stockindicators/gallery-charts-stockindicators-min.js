YUI.add("gallery-charts-stockindicators",function(e,t){function o(){this.init.apply(this,arguments)}var n=e.config.win,r=e.config.doc,i=e.Color,s=i.toHex;e.Axis.prototype.getLabel=function(t){var n,i,s=this._labelCache,o={rotation:"rotation",margin:"margin",alpha:"alpha",align:"align"};s&&s.length>0?i=s.shift():(i=r.createElement("span"),i.className=e.Lang.trim([i.className,"axisLabel"].join(" ")),this.get("contentBox").append(i)),r.createElementNS||i.style.filter&&(i.style.filter=null),i.style.display="block",i.style.whiteSpace="nowrap",i.style.position="absolute";for(n in t)t.hasOwnProperty(n)&&!o.hasOwnProperty(n)&&(i.style[n]=t[n]);return i},e.Axis.prototype._setCanvas=function(){var t=this.get("contentBox"),n=this.get("boundingBox"),r=this.get("position"),i=this._parentNode,s=this.get("width"),o=this.get("height");n.setStyle("position","absolute"),s=s?s+"px":i.getStyle("width"),o=o?o+"px":i.getStyle("height"),r==="top"||r==="bottom"?t.setStyle("width",s):t.setStyle("height",o),t.setStyle("position","relative"),t.setStyle("left","0px"),t.setStyle("top","0px"),this.set("graphic",new e.Graphic),this.get("graphic").render(t)},e.LeftAxisLayout.prototype.positionLabel=function(e,t,n,r){var i=this,s=parseFloat(n.label.offset),o=i.get("leftTickOffset"),u=this._totalTitleSize,a=t.x+u-o,f=t.y,l=this._labelRotationProps,c=l.rot,h=l.absRot,p=n.label,d=i._maxLabelSize,v=this._labelWidths[r],m=this._labelHeights[r];c===0?(a-=v,p.align&&p.align==="left"&&(a-=d-v),f-=m*s):c===90?(a-=v*.5,f=f+v/2-v*s):c===-90?(a-=v*.5,f=f-m+v/2-v*s):(a-=v+m*h/360,f-=m*s),l.labelWidth=v,l.labelHeight=m,l.x=Math.round(d+a),l.y=Math.round(f),this._rotate(e,l)},e.RightAxisLayout.prototype.positionLabel=function(e,t,n,r){var i=this,s=parseFloat(n.label.offset),o=i.get("rightTickOffset"),u=n.label,a=0,f=t.x,l=t.y,c=this._labelRotationProps,h=c.rot,p=c.absRot,d=this._labelWidths[r],v=this._labelHeights[r];u.margin&&u.margin.left&&(a=u.margin.left),h===0?(u.align==="right"&&(f+=i._maxLabelSize-d),l-=v*s):h===90?(f-=d*.5,l=l-v+d/2-d*s):h===-90?(l=l+d/2-d*s,f-=d*.5):(l-=v*s,f+=v/2*p/90),f+=a,f+=o,c.labelWidth=d,c.labelHeight=v,c.x=Math.round(f),c.y=Math.round(l),this._rotate(e,c)},e.IntradayAxisBase=function(){e.IntradayAxisBase.superclass.constructor.apply(this,arguments)},e.IntradayAxisBase.NAME="intradayAxisBase",e.extend(e.IntradayAxisBase,e.CategoryAxisBase,{_maximumSetter:function(e){var t=e,n=this.get("dataGranularity"),r,i=this.get("dataProvider"),s=i[i.length-1].Timestamp;if(n){r=parseFloat(n)*6e4,t=+(new Date(t)),s=+(new Date(s));if(t>s){while(t>s)s+=r,i.push({Timestamp:s});this.set("dataProvider",i)}}}},{ATTRS:{dataGranularity:{lazyAdd:!1}}}),e.IntradayAxis=e.Base.create("intradayAxis",e.CategoryAxis,[e.IntradayAxisBase]),e.CanvasAxis=e.Base.create("canvasAxis",e.AxisBase,[e.Renderer],e.merge(e.Axis.prototype,{_rotate:function(e,t){var n=t.x+this._xOffset,r=t.y+this._yOffset;this._context.fillText(e,n,r)},_drawAxis:function(){if(this._layout){var e=this.get("styles"),t=e.margin,n,r,i,s,o=e.line,u=e.label,a=e.majorTicks,f=a.display!=="none",l,c=0,h=this._layout,p,d,v,m,g,y,b=this.get("labelFunction"),w=this.get("labelFunctionScope"),E=this.get("labelFormat"),S=this.get("path"),x=S.getContext("2d"),T,N=this.get("position"),C,k,L,A=[],O,M,_,D,P,H,B,j,F,I=h._getDefaultMargins(),q=this._labelValuesExplicitlySet?this.get("labelValues"):null,R=N==="left"||N==="right"?"vertical":"horizontal";t&&(n=typeof t.left=="number"&&isFinite(t.left)?t.left:0,r=typeof t.right=="number"&&isFinite(t.right)?t.right:0,i=typeof t.top=="number"&&isFinite(t.top)?t.top:0,s=typeof t.bottom=="number"&&isFinite(t.bottom)?t.bottom:0);for(c in I)I.hasOwnProperty(c)&&(u.margin[c]=u.margin[c]===undefined?I[c]:u.margin[c]);this._context=x,this._labelWidths=[],this._labelHeights=[],this._labels=[],x.clearRect(0,0,S.width,S.height),x.strokeStyle=o.color,x.strokeWidth=o.weight,this._labelRotationProps=this._getTextRotationProps(u),this._labelRotationProps.transformOrigin=h._getTransformOrigin(this._labelRotationProps.rot),h.setTickOffsets.apply(this),p=this.getLength(),l=this.getTotalMajorUnits(),F=this.getEdgeOffset(l,p),this.set("edgeOffset",F),d=h.getLineStart.apply(this),v=this.getLineEnd(d),R==="vertical"?(B="x",j="y"):(B="y",j="x"),C=this._getLabelData(d[B],B,j,this.get("minimum"),this.get("maximum"),F,p-F-F,l,q),M=C.points,k=C.values,l=M.length,this._labelValuesExplicitlySet||this.set("labelValues",k,{src:"internal"}),this.get("hideFirstMajorUnit")&&(_=M.shift(),P=k.shift(),l-=1),this.get("hideLastMajorUnit")&&(D=M.pop(),H=k.pop(),l-=1);if(l>=1){x.moveTo(d.x,d.y),x.lineTo(v.x,v.y),x.stroke();if(f){x.strokeStyle=a.color,x.strokeWidth=a.weight;for(c=0;c<l;c+=1)O=M[c],O&&h.drawTick.apply(this,[x,M[c],a])}this._maxLabelSize=0,this._totalTitleSize=0,this._titleSize=0,T=h.getExplicitlySized.apply(this,[e]);for(c=0;c<l;c+=1)O=M[c],O&&(m=this.getLabel(u),this._labels.push(m),L=b.apply(w,[k[c],E]),this.get("appendLabelFunction")(m,L),g=Math.round(m.offsetWidth),y=Math.round(m.offsetHeight),T||this._layout.updateMaxLabelSize.apply(this,[g,y]),this._removeChildren(m),m.parentNode.removeChild(m),this._labels.pop(),this._labelWidths.push(g),this._labelHeights.push(y),A.push(L));this._xOffset=0,this._yOffset=0,this._widthOffset=0,this._heightOffset=0;switch(N){case"left":this._explicitWidth?this.set("calculatedWidth",this._explicitWidth):this.set("calculatedWidth",Math.round(this._totalTitleSize+e.get("leftTickOffset")+this._maxLabelSize+u.margin.right)),this._yOffset=i,this._heightOffset=i+s;break;case"right":this._explicitWidth?this.set("calculatedWidth",this._explicitWidth):this.set("calculatedWidth",Math.round(this.get("rightTickOffset")+this._maxLabelSize+this._totalTitleSize+u.margin.left)),this._yOffset=i,this._heightOffset=i+s;break;case"top":this._explicitHeight?this.set("calculatedHeight",this._explicitHeight):this.set("calculatedHeight",Math.round(this.get("topTickOffset")+this._maxLabelSize+u.margin.bottom+this._totalTitleSize)),this._xOffset=n,this
._widthOffset=n+r;break;case"bottom":this._explicitHeight?this.set("calculatedHeight",this._explicitHeight):this.set("calculatedHeight",Math.round(this.get("bottomTickOffset")+this._maxLabelSize+u.margin.top+this._totalTitleSize)),this._xOffset=n,this._widthOffset=n+r}S.style.left=this.get("x")-this._xOffset+"px",S.style.top=this.get("y")-this._yOffset+"px",x.font=u.fontSize+" "+u.fontFamily.toString(),x.textBaseline="top",l=A.length;for(c=0;c<l;++c)h.positionLabel.apply(this,[A[c],M[c],e,c]);_&&M.unshift(_),D&&M.push(D),P&&k.unshift(P),H&&k.push(H),this._tickPoints=M}}},destructor:function(){var e;this._path&&(this._context&&this._context.clearRect(0,0,this.get("width")+this._widthOffset,this.get("height")+this._heightOffset),e=this._path.parentNode,e&&e.removeChild(this._path))}}),{ATTRS:e.merge(e.Axis.ATTRS,{x:{value:0},y:{value:0},calculatedWidth:{setter:function(e){return this._calculatedWidth=e,this._path.width=e+this._widthOffset,this._path.height=this.get("height")+this._heightOffset,e}},calculatedHeight:{setter:function(e){return this._calculatedHeight=e,this._path.height=e+this._heightOffset,this._path.width=this.get("width")+this._widthOffset,e}},render:{},contentBox:{getter:function(){return this.get("render")||e.one(r.body)}},path:{readOnly:!0,getter:function(){var e;return this._path||(this._path=r.createElement("canvas"),this._path.style.position="absolute",e=this.get("render"),e&&e._node.appendChild(this._path)),this._path}},tickPath:null})}),e.NumericCanvasAxis=e.Base.create("numericCanvasAxis",e.CanvasAxis,[e.NumericImpl],e.NumericAxis.prototype),e.CategoryCanvasAxis=e.Base.create("categoryCanvasAxis",e.CanvasAxis,[e.CategoryImpl],e.CategoryAxis.prototype,{ATTRS:{labelFormat:{}}}),e.IntradayCanvasAxis=e.Base.create("intradayCanvasAxis",e.CategoryCanvasAxis,[e.IntradayAxisBase]),e.VolumeColumn=function(){e.VolumeColumn.superclass.constructor.apply(this,arguments)},e.VolumeColumn.NAME="volumeColumn",e.extend(e.VolumeColumn,e.RangeSeries,{drawSeries:function(){var e=this.get("yAxis").get("dataProvider"),t=this.get("xcoords"),n=this.get("ycoords"),r=this.get("upPath"),i=this.get("downPath"),s=t.length,o=this.get("styles"),u=o.padding,a=this.get("width")-(u.left+u.right),f=this._calculateMarkerWidth(a,s,o.spacing),l=f/2,c=this.get("previousClose");o.upPath.fill.opacity=o.upPath.fill.alpha,o.downPath.fill.opacity=o.downPath.fill.alpha,this._drawColumns(r,i,o,e,c,t,n,f,l)},_drawColumns:function(e,t,n,r,i,s,o,u,a){var f=this._bottomOrigin,l,c,h,p,d,v=s.length,m=!1,g=!1;e.set(n.upPath),t.set(n.downPath),e.clear(),t.clear();for(d=0;d<v;d+=1)i&&r[d].close<i?(p=t,g=!0):(p=e,m=!0),c=s[d]-a,l=o[d],h=f-l,h>0&&!isNaN(c)&&!isNaN(l)&&p.drawRect(c,l,u,h),i=r[d].close;m&&e.end(),g&&t.end()},_toggleVisible:function(e){this.get("upPath").set("visible",e),this.get("downPath").set("visible",e)},_getDefaultStyles:function(){var t={upPath:{shapeRendering:"crispEdges",fill:{color:"#00aa00",alpha:1},stroke:{color:"#000000",alpha:1,weight:0}},downPath:{shapeRendering:"crispEdges",fill:{color:"#aa0000",alpha:1},stroke:{color:"#000000",alpha:1,weight:0}}};return this._mergeStyles(t,e.VolumeColumn.superclass._getDefaultStyles())}},{ATTRS:{ohlcKeys:{value:null},type:{value:"volumecolumn"},graphic:{lazyAdd:!1,setter:function(e){return this.get("rendered")||this.set("rendered",!0),this.set("upPath",e.addShape({type:"path"})),this.set("downPath",e.addShape({type:"path"})),e}},upPath:{},downPath:{},previousClose:{lazyAdd:!1}}}),e.CanvasSeriesImpl=function(){},e.CanvasSeriesImpl.ATTRS={x:{},y:{},width:{lazyAdd:!1,getter:function(){return this._width},setter:function(e){return this._width=e,e}},height:{lazyAdd:!1,getter:function(){return this._height},setter:function(e){return this._height=e,e}},graphic:{lazyAdd:!1,setter:function(e){var t=e,n=this._getPathAttrs(),r,i;this.get("rendered")||this.set("rendered",!0),t&&t._node&&(t=t._node);if(n){i=n.length;for(r=0;r<i;r+=1)this.set(n[r],this._getPath(t))}return e}}},e.CanvasSeriesImpl.prototype={_getPath:function(e){var t=r.createElement("canvas"),n=t.getContext("2d"),i,s=this._paths||[];return e&&e.appendChild(t),t.style.position="absolute",i={canvas:t,context:n},s.push(i),this._paths=s,i},_getPathAttrs:function(){return null},_clearPaths:function(t){var n,r,i=this.get("width"),s=this.get("height");if(e.Lang.isArray(t)){r=t.length;for(n=0;n<r;n+=1)t[n].context.clearRect(0,0,i,s)}else t.context.clearRect(0,0,i,s)},_toggleVisible:function(e){var t=e?"visible":"hidden",n=this._paths,r,i,s;if(n){s=n.length;for(i=0;i<s;i+=1)r=this._paths[i],r.canvas.style.visibility=t}},_toRGBA:function(e,t){return t=t!==undefined?t:1,i.re_RGB.test(e)||(e=s(e)),i.re_hex.exec(e)&&(e="rgba("+[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)].join(",")+","+t+")"),e},_drawRect:function(e,t,n,r,i){return e.moveTo(t,n),e.lineTo(t+r,n),e.lineTo(t+r,n+i),e.lineTo(t,n+i),e.lineTo(t,n),e},_drawCircleByCircumference:function(e,t,n,r){var i=0,s=2*Math.PI,o=r/2;return e.moveTo(t,n),e.arc(t+o,n+o,o,i,s,!1),e},_drawDiamond:function(e,t,n,r,i){var s=r*.5,o=i*.5;return e.moveTo(t+s,n),e.lineTo(t+r,n+o),e.lineTo(t+s,n+i),e.lineTo(t,n+o),e.lineTo(t+s,n),e},_drawEllipse:function(e,t,n,r,i){var s=8,o=-0.25*Math.PI,u=0,a,f=r/2,l=i/2,c,h=t+f,p=n+l,d,v,m,g,y,b;d=h+Math.cos(0)*f,v=p+Math.sin(0)*l,e.moveTo(d,v);for(c=0;c<s;c++)u+=o,a=u-o/2,m=h+Math.cos(u)*f,g=p+Math.sin(u)*l,y=h+Math.cos(a)*(f/Math.cos(o/2)),b=p+Math.sin(a)*(l/Math.cos(o/2)),e.quadraticCurveTo(y,b,m,g);return e},destructor:function(){var t,n,r,i=this._paths,s=this._getPathAttrs(),o,u,a=this.get("width"),f=this.get("height"),l;if(i){u=i.length;for(o=0;o<u;o+=1)t=i[o],n=t.context,n&&n.clearRect(0,0,a,f),r=t.canvas,r&&(l=r.parentNode,e.Event.purgeElement(r,!0),l&&l.removeChild(r))}if(s){u=s.length;for(o=0;o<u;o+=1)this.set(s[o],null)}}},e.CanvasLines=function(){},e.extend(e.CanvasLines,e.Lines,{drawLines:function(){if(this.get("xcoords").length<1)return;var t=e.Lang.isNumber,n,r,i=this.get("direction"),s,o,u,a=!0,f,l,c,h,p,d=
this.get("styles").line,v=d.lineType,m=d.color||this._getDefaultColor(this.get("graphOrder"),"line"),g=d.alpha,y=d.dashLength,b=d.gapSpace,w=d.connectDiscontinuousPoints,E=d.discontinuousType,S=d.discontinuousDashLength,x=d.discontinuousGapSpace,T=this.get("linePath"),N=T.context,C=this.get("width"),k=this.get("height");T.canvas.width=C,T.canvas.height=k,this._stacked?(n=this.get("stackedXCoords"),r=this.get("stackedYCoords")):(n=this.get("xcoords"),r=this.get("ycoords")),s=i==="vertical"?r.length:n.length,this._clearPaths(T),N.strokeStyle=t(g)?this._toRGBA(m,g):m,N.lineWidth=d.weight;for(p=0;p<s;p=++p){c=n[p],h=r[p],u=t(c)&&t(h);if(!u){o=u;continue}a?(a=!1,N.moveTo(c,h)):o?v!=="dashed"?N.lineTo(c,h):this.drawDashedLine(T,f,l,c,h,y,b):w?E!=="solid"?this.drawDashedLine(T,f,l,c,h,S,x):N.lineTo(c,h):N.moveTo(c,h),f=c,l=h,o=!0}N.stroke()},drawDashedLine:function(t,n,r,i,s,o,u){var a=t.context;e.CanvasLines.superclass.drawDashedLine.apply(this,[a,n,r,i,s,o,u])},_moveTo:function(e,t,n){e.context.moveTo(t,n)},_lineTo:function(e,t,n){e.context.lineTo(t,n)},_endPaths:function(t){var n,r;if(e.Lang.isArray(t)){r=t.length;for(n=0;n<r;n+=1)t[n].context.lineWidth=t[n].lineWidth,t[n].context.strokeStyle=t[n].strokeStyle,t[n].context.stroke()}else t.context.lineWidth=t.lineWidth,t.context.strokeStyle=t.strokeStyle,t.context.stroke()}}),e.CanvasLineSeries=e.Base.create("lineSeries",e.LineSeries,[e.CanvasSeriesImpl,e.CanvasLines],{_getPathAttrs:function(){return["linePath"]}},{ATTRS:{type:"canvasLine"}}),e.CanvasPlots=function(){},e.extend(e.CanvasPlots,e.Plots,{drawPlots:function(){if(!this.get("xcoords")||this.get("xcoords").length<1)return;var t=e.Lang.isNumber,n=this._copyObject(this.get("styles").marker),r=n.width,i=n.height,s=this.get("xcoords"),o=this.get("ycoords"),u,a=s.length,f=o[0],l,c=r/2,h=i/2,p=this._getShapeMethod(n.shape),d=this.get("markerPath"),v=d.context,m=d.canvas,g=!1,y=n.fill,b=n.fill.color,w=n.fill.alpha,E=n.border,S=E.color,x=E.weight,T=E.alpha,N=y&&b,C=E&&x&&S;this._clearPaths(d),m.width=this.get("width"),m.height=this.get("height");if(p){N&&(v.fillStyle=t(w)?this._toRGBA(b,w):b),C&&(v.strokeStyle=t(T)?this._toRGBA(S,T):S,v.lineWidth=x),v.beginPath();for(u=0;u<a;u+=1)f=parseFloat(o[u]-h),l=parseFloat(s[u]-c),t(l)&&t(f)&&(g=!0,v=p(v,l,f,r,i));g&&(N&&(v.closePath(),v.fill()),C&&v.stroke())}},_getShapeMethod:function(e){var t={rect:this._drawRect,circle:this._drawCircleByCircumference,ellipse:this._drawEllipse};return t[e]}}),e.CanvasMarkerSeries=e.Base.create("canvasMarkerSeries",e.MarkerSeries,[e.Plots,e.CanvasSeriesImpl,e.CanvasPlots],{_getPathAttrs:function(){return["markerPath"]}},{ATTRS:{type:"canvasMarker"}}),e.CanvasFills=function(){},e.extend(e.CanvasFills,e.Fills,{drawFill:function(t,n){if(t.length<1)return;var r=e.Lang.isNumber,i=t.length,s=t[0],o=n[0],u=s,a=o,f,l,c,h=!0,p=0,d=this.get("styles").area,v=this.get("areaPath"),m=d.color||this._getDefaultColor(this.get("graphOrder"),"slice"),g=d.alpha,y=v.context,b=this.get("width"),w=this.get("height");v.canvas.width=b,v.canvas.height=w,this._clearPaths(v),y.fillStyle=r(g)?this._toRGBA(m,g):m,y.beginPath();for(;p<i;p=++p){f=t[p],l=n[p],c=r(f)&&r(l);if(!c)continue;h?(this._firstValidX=f,this._firstValidY=l,h=!1,y.moveTo(f,l)):y.lineTo(f,l),u=f,a=l}this._lastValidX=u,this._lastValidY=a,y.closePath(),y.fill()}}),e.CanvasAreaSeries=e.Base.create("areaSeries",e.AreaSeries,[e.Fills,e.CanvasSeriesImpl,e.CanvasFills],{_getPathAttrs:function(){return["areaPath"]}},{ATTRS:{type:"canvasArea"}}),e.CanvasComboSeries=e.Base.create("canvasComboSeries",e.ComboSeries,[e.Fills,e.CanvasSeriesImpl,e.CanvasLines,e.CanvasFills],{_getPathAttrs:function(){return["linePath","areaPath"]}},{ATTRS:{type:"canvasCombo"},showAreaFill:{value:!1},showLines:{value:!0},showMarkers:{value:!0}}),e.CanvasColumnSeries=e.Base.create("canvasColumnSeries",e.ColumnSeries,[e.CanvasSeriesImpl],{_getPathAttrs:function(){return["columnPath"]},drawSeries:function(){var t=e.Lang.isNumber,n=this.get("xcoords"),r=this.get("ycoords"),i,s,o=this._copyObject(this.get("styles").marker),u,a=n.length,f,l=r[0],c=this.get("columnPath"),h=c.context,p=c.canvas,d=o.width,v=d/2,m,g=o.fill,y=g.color,b=g.alpha,w=o.border,E=w.color,S=w.weight,x=w.alpha,T=g&&y,N=w&&S&&E,C=this._bottomOrigin,k=!1;this._clearPaths(c),p.width=this.get("width"),p.height=this.get("height"),T&&(h.fillStyle=t(b)?this._toRGBA(y,b):y),N&&(h.strokeStyle=t(x)?this._toRGBA(E,x):E,h.lineWidth=S),h.beginPath();for(u=0;u<a;u+=1)i=parseFloat(n[u]),s=parseFloat(r[u]),f=i-v,C>=s?(l=s,m=C-l):(l=C,m=s-C),t(f)&&t(l)&&t(d)&&t(m)&&(k=!0,h.moveTo(f,l),h.lineTo(f+d,l),h.lineTo(f+d,l+m),h.lineTo(f,l+m),h.lineTo(f,l));k&&(T&&(h.closePath(),h.fill()),N&&h.stroke())}},{ATTRS:{type:"canvasColumn"}}),e.CanvasCandlestickSeries=e.Base.create("canvasCandlestickSeries",e.CandlestickSeries,[e.CanvasSeriesImpl],{_drawMarkers:function(t,n,r,i,s,o,u,a,f){var l=this.get("upcandle"),c=this.get("downcandle"),h,p=this.get("wick"),d=f.wick,v=d.width,m=!1,g=!1,y=!1,b,w,E,S,x,T,N,C,k,L,A=f.padding.left,O,M,_=e.Lang.isNumber,D=this.get("width"),P=this.get("height"),H=this.get("x"),B=this.get("y");l.canvas.style.left=H+"px",l.canvas.style.top=B+"px",c.canvas.style.left=H+"px",c.canvas.style.top=B+"px",p.canvas.style.left=H+"px",p.canvas.style.top=B+"px",l.canvas.width=D,l.canvas.height=P,c.canvas.width=D,c.canvas.height=P,p.canvas.width=D,p.canvas.height=P,l.context.fillStyle=f.upcandle.fill.color,c.context.fillStyle=f.downcandle.fill.color,l.context.strokeStyle=f.upcandle.stroke.color,c.context.strokeStyle=f.downcandle.stroke.color,l.context.lineWidth=f.upcandle.stroke.weight,c.context.lineWidth=f.downcandle.stroke.weight,p.context.fillStyle=f.wick.fill.color,p.context.lineWidth=f.wick.stroke.weight,l.context.clearRect(0,0,D,P),c.context.clearRect(0,0,D,P),p.context.clearRect(0,0,D,P);for(M=0;M<o;M+=1)b=Math.round(t[M]+A),T=b-a,N=b+a,w=Math.round(n[M]),E=Math.round(r[M]),S=Math.round(i[M]),x=Math.round(s[M]),O=w>x,O?(C=x,k=w,h=l,m=!0):(C=w,k=x,h=c,g=!0),L=
k-C,h&&_(T)&&_(C)&&_(u)&&_(L)&&(h.context=this._drawRect(h.context,T,C,u,L)),_(b)&&_(E)&&_(S)&&(y=!0,p.context=this._drawRect(p.context,b-v/2,E,v,S-E));m&&(l.context.closePath(),l.context.fill()),g&&(c.context.closePath(),c.context.fill()),y&&(p.context.closePath(),p.context.fill())},_getPathAttrs:function(){return["wick","upcandle","downcandle"]}},{ATTRS:{type:{value:"canvasCandlestick"}}}),e.CanvasOHLCSeries=e.Base.create("canvasOHLCSeries",e.OHLCSeries,[e.CanvasSeriesImpl],{_drawMarkers:function(t,n,r,i,s,o,u,a,f){var l=this.get("upmarker"),c=this.get("downmarker"),h,p,d,v,m,g,y=f.padding.left,b,w,E,S,x,T=this.get("width"),N=this.get("height"),C=l.context,k=c.context,L=f.upmarker.stroke,A=f.downmarker.stroke,O=L.color,M=L.alpha,_=A.color,D=A.alpha;l.canvas.width=T,l.canvas.height=N,c.canvas.width=T,c.canvas.height=N,this._clearPaths(l),this._clearPaths(c),C.lineWidth=L.weight,C.strokeStyle=e.Lang.isNumber(M)?this._toRGBA(O,M):O,k.lineWidth=A.weight,k.strokeStyle=e.Lang.isNumber(D)?this._toRGBA(_,D):_;for(S=0;S<o;S+=1)E=t[S]+y,m=E-a,g=E+a,h=n[S],p=r[S],d=i[S],v=s[S],w=h>v,x=d-p,b=w?C:k,b.moveTo(m,h),b.lineTo(E,h),b.moveTo(E,p),b.lineTo(E,d),b.moveTo(E,v),b.lineTo(g,v);C.stroke(),k.stroke()},_getPathAttrs:function(){return["upmarker","downmarker"]}},{ATTRS:{type:{value:"canvasOHLC"}}}),e.VolumeColumnCanvas=e.Base.create("volumeColumnCanvas",e.VolumeColumn,[e.CanvasSeriesImpl],{drawSeries:function(){var e=this.get("yAxis").get("dataProvider"),t=this.get("xcoords"),n=this.get("ycoords"),r=this.get("upPath"),i=this.get("downPath"),s=t.length,o=this.get("styles"),u=o.padding,a=this.get("width")-(u.left+u.right),f=this._calculateMarkerWidth(a,s,o.spacing),l=f/2,c=this.get("previousClose");o.upPath.fill.opacity=o.upPath.fill.alpha,o.downPath.fill.opacity=o.downPath.fill.alpha,this._drawColumns(r,i,o,e,c,t,n,f,l)},_drawColumns:function(e,t,n,r,i,s,o,u,a){var f=this._bottomOrigin,l,c,h,p,d,v=s.length,m=!1,g=!1,y=this.get("width"),b=this.get("height"),w=this.get("x"),E=this.get("y");e.canvas.style.left=w+"px",e.canvas.style.top=E+"px",t.canvas.style.left=w+"px",t.canvas.style.top=E+"px",e.canvas.width=y,e.canvas.height=b,t.canvas.width=y,t.canvas.height=b,e.context.fillStyle=n.upPath.fill.color,t.context.fillStyle=n.downPath.fill.color,e.context.strokeStyle=n.upPath.stroke.color,t.context.strokeStyle=n.downPath.stroke.color,e.context.lineWidth=n.upPath.stroke.weight,t.context.lineWidth=n.downPath.stroke.weight,e.context.clearRect(0,0,y,b),t.context.clearRect(0,0,y,b);for(d=0;d<v;d+=1)i&&r[d].close<i?(p=t.context,g=!0):(p=e.context,m=!0),c=s[d]-a,l=o[d],h=f-l,h>0&&!isNaN(c)&&!isNaN(l)&&(p.moveTo(c,l),p.lineTo(c+u,l),p.lineTo(c+u,l+h),p.lineTo(c,l+h),p.lineTo(c,l)),i=r[d].close;m&&(e.context.closePath(),e.context.fill()),g&&(t.context.closePath(),t.context.fill())},_getPathAttrs:function(){return["upPath","downPath"]}},{ATTRS:{type:{value:"volumeColumnCanvas"}}}),e.ThresholdLines=function(){e.ThresholdLines.superclass.constructor.apply(this,arguments)},e.ThresholdLines.NAME="thresholdLines",e.ThresholdLines.ATTRS={thresholds:{}},e.extend(e.ThresholdLines,e.Lines,{_getPaths:function(e,t,n){var r,i,s,o,u,a,f,l;if(!e){r=this.get("graphic")||this.get("graph").get("graphic"),e=[],o=t.color,u=t.alpha,a=t.weight,f=typeof u=="object"&&u.length&&u.length>0,l=typeof o=="object"&&o.length&&o.length>0;for(s=0;s<n;s+=1)i=r.addShape({type:"path",stroke:{color:l?o[s%o.length]:o,opacity:f?u[s%u.length]:u,weight:a}}),e.push(i)}else this._clearPaths(e);return e},_getThresholdCoords:function(e,t,n,r,i,s){var o=this.get("yAxis"),u,a=this.get("height"),f=n.padding,l=f.top+s,c=[];a=a-f.top-f.bottom-s*2,l=a-l;for(u=0;u<t;u+=1)c.push(Math.round(o._getCoordFromValue(r,i,a,e[u],l,!0)*1e3)/1e3);return c},_drawThresholdLines:function(e,t,n,r){var i,s,o=this.get("xAxis"),u=o.get("edgeOffset"),a=this.get("width"),f=r.thresholds,l=f.lineType,c=f.dashLength,h=f.gapSpace,p=r.padding.left+u,d=a-u-r.padding.right,v;for(s=0;s<n;s+=1)v=t[s],i=e[s],this._clearPaths(i),this._moveTo(i,p,v),l==="dashed"?this.drawDashedLine(i,p,v,d,v,c,h):this._lineTo(i,d,v),this._endPaths(i)},_moveTo:function(e,t,n){e.moveTo(t,n)},_lineTo:function(e,t,n){e.lineTo(t,n)},_clearPaths:function(t){var n,r;if(e.Lang.isArray(t)){r=t.length;for(n=0;n<r;n+=1)t[n].clear()}else t.clear()},_endPaths:function(t){var n,r;if(e.Lang.isArray(t)){r=t.length;for(n=0;n<r;n+=1)t[n].end()}else t.end()},_getDefaultStyles:function(){var t={thresholds:{color:"#999",alpha:1,weight:1,lineType:"dashed",dashLength:5,gapSpace:5}};return e.merge(e.Renderer.prototype._getDefaultStyles(),t)},destructor:function(){var t,n=this.get("width"),r=this.get("height"),i,s,o;if(this._paths)while(this._paths.length>0)t=this._paths.pop(),t instanceof e.Shape?t.destroy():(i=t.context,s=t.canvas,i&&i.clearRect(0,0,n,r),s&&(o=s.parentNode,e.Event.purgeElement(s,!0),o&&o.removeChild(t.canvas)))}}),e.ThresholdCanvasLines=e.Base.create("tresholdCanvasLines",e.ThresholdLines,[e.CanvasLines],{_getPaths:function(e,t,n){var i,s,o,u,a,f,l,c=this.get("width"),h=this.get("height"),p,d=this.get("x")+"px",v=this.get("y")+"px";if(!e){i=this.get("node"),e=[],u=t.color,a=t.weight,p=typeof u=="object"&&u.length&&u.length>0;for(o=0;o<n;o+=1)f=r.createElement("canvas"),l=f.getContext("2d"),f.width=c,f.height=h,f.style.position="absolute",f.style.left=d,f.style.top=v,i&&i.appendChild(f),s={canvas:f,context:l,strokeStyle:p?u[o%u.length]:u,lineWidth:a},e.push(s)}else this._clearPaths(e);return e}},{ATTRS:{x:{},y:{},width:{lazyAdd:!1,getter:function(){return this._width},setter:function(e){return this._width=e,e}},height:{lazyAdd:!1,getter:function(){return this._height},setter:function(e){return this._height=e,e}},node:{setter:function(e){return this.get("rendered")||this.set("rendered",!0),e}},graphic:{lazyAdd:!1,setter:function(e){var t=e;return t&&(t._node&&(t=t._node),this.set("node",t)),e}}}}),e.ThresholdLineSeries=e.Base.create("thresholdLineSeries",e.SeriesBase,[e.Lines,e.ThresholdLines],{initializer:function(){var e=
this.get("width"),t=this.get("height"),n=this.get("yAxis");isFinite(e)&&isFinite(t)&&e>0&&t>0&&n&&this.draw()},draw:function(){var e=this.get("thresholds"),t=e?e.length:0,n=this.get("styles"),r=this.get("yAxis"),i=r.get("minimum"),s=r.get("maximum"),o=r.get("edgeOffset"),u=this._getThresholdCoords(e,t,n,i,s,o),a=this._getPaths(this._paths,n.thresholds,t);this._drawThresholdLines(a,u,t,n),this._paths=a}},{ATTRS:{xAxis:{},yAxis:{}}}),e.ThresholdCanvasLineSeries=e.Base.create("thresholdCanvasLineSeries",e.ThresholdLineSeries,[e.CanvasSeriesImpl,e.CanvasLines,e.ThresholdCanvasLines]),e.MultipleLineSeries=e.Base.create("multipleLineSeries",e.CartesianSeries,[e.Lines,e.ThresholdLines],{drawSeries:function(){if(this.get("xcoords").length<1)return;var e=this.get("direction"),t,n,r,i=!0,s,o,u,a,f,l,c,h,p=this.get("thresholds"),d=p?p.length:0,v,m,g,y=this.get("styles"),b=y.thresholds.drawLines,w=this._getPaths(this._graphPaths,y,d+1),E=this.get("yAxis"),S=E.get("minimum"),x=E.get("maximum"),T=E.get("edgeOffset"),N=this._getThresholdCoords(p,d,y,S,x,T),C,k=this.get("xcoords"),L=this.get("ycoords");b&&(C=this._getPaths(this._thresholdPaths,y.thresholds,d),this._drawThresholdLines(C,N,d,y)),this._graphPaths=w,this._thresholdPaths=C,this._paths=this._graphPaths.concat(this._thresholdPaths?this._thresholdPaths:[]),t=e==="vertical"?L.length:k.length;for(c=0;c<t;c+=1){u=Math.round(k[c]*1e3)/1e3,a=Math.round(L[c]*1e3)/1e3,r=typeof u=="number"&&isFinite(u)&&typeof a=="number"&&isFinite(a);if(r){g=0;if(p)for(v=0;v<d;v+=1){if(a<=N[v])break;g=v}else v=0;i?(i=!1,this._moveTo(w[v],u,a)):(v!==m&&(h=Math.round((a-o)/(u-s)*1e3)/1e3,f=(N[g]-a)/h+u,l=N[g],typeof m=="number"&&isFinite(m)&&this._lineTo(w[m],f,l),this._moveTo(w[v],f,l)),this._lineTo(w[v],u,a)),s=u,o=a,n=!0,m=v}else n=r}this._endPaths(w)},_getDefaultStyles:function(){var t={alpha:1,weight:6,color:this._defaultLineColors.concat()};return e.merge(e.ThresholdLines.prototype._getDefaultStyles(),t)}}),e.MultipleLineCanvasSeries=e.Base.create("multipleLineCanvasSeries",e.CartesianSeries,[e.Lines,e.ThresholdLines,e.MultipleLineSeries,e.ThresholdCanvasLines]),e.Crosshair=function(){this.initializer.apply(this,arguments)},e.Crosshair.prototype={initializer:function(t){var n=new e.Graphic({render:t.render,autoDraw:!1,width:t.width,height:t.height,x:t.x,y:t.y}),r=t.width,i=t.height,s=t.series,o,u=t.category,a,f,l=s.length,c=t.graphX-t.x,h=t.graphY-t.y;a=n.addShape({shapeRendering:"crispEdges",type:"path",stroke:u.stroke}).moveTo(c,0).lineTo(c,i).end(),this._xcoords=u.coords,this._yline=a,this.width=t.width,this.height=t.height;if(s){for(f=0;f<l;f+=1)o=s[f],o.line&&(o.xLine=n.addShape({shapeRendering:"crispEdges",type:"path",stroke:o.line.stroke}).moveTo(0,h).lineTo(r,h).end()),o.marker&&(o.marker.y=h-o.marker.height/2,o.marker.x=c-o.marker.width/2,o.marker.type=o.marker.type||o.marker.shape,o.marker=n.addShape(o.marker));this._series=s}this._xy=n.getXY(),this.graphic=n},setTarget:function(e,t){var n=this._xy,r=e-n[0],i,s=this._series,o,u,a=Math.floor(r/this.width*this._xcoords.length),f=s.length,l;this._yline.set("transform","translate("+r+")");if(s)for(u=0;u<f;u+=1)o=s[u],i=o.coords[a],l=typeof i=="number"&&isFinite(i),o.marker&&(l&&o.marker.set("transform","translate("+r+", "+i+")"),o.marker.set("visible",l)),o.line&&(l&&o.xLine.set("transform","translateY("+i+")"),o.xLine.set("visible",l));this.updateFlag=!0,t&&this.graphic._redraw()},redraw:function(){this.updateFlag&&(this.graphic._redraw(),this.updateFlag=!1)},destroy:function(){this.graphic&&this.graphic.destroy()}},e.Gridlines=e.Base.create("gridlines",e.Base,[e.Renderer],{_path:null,remove:function(){var e=this._path;e&&e.destroy()},draw:function(e,t,n,r){this.get("axis")&&this.get("graphic")&&this._drawGridlines(e,t,n,r)},_drawGridlines:function(e,t,n,r){var i=this._path,s=this.get("axis"),o=s.get("position"),u,a=this.get("direction"),f=this.get("styles"),l=f.fill,c=f.border,h=f.line,p=l&&c?c:h,d=this.get("x"),v=this.get("y");n=n||0,r=r||2,isFinite(e)&&isFinite(t)&&e>0&&t>0&&(o!=="none"&&s&&s.get("tickPoints")?u=s.get("tickPoints"):u=this._getPoints(s.get("styles").majorUnit.count,e,t),i?i=this._stylePath.apply(this,[i,e,t,d,v,p,l]):(i=this._getPath.apply(this,[e,t,d,v,p,l]),this._path=i),a==="vertical"?l?this._verticalFill.apply(this,[i,u,t,n,r,e]):this._verticalLine.apply(this,[i,u,t,f]):l?this._horizontalFill.apply(this,[i,u,e,n,r,t]):this._horizontalLine.apply(this,[i,u,e,f]),this._endPath.apply(this,[i]))},_endPath:function(e){e.end()},_getPath:function(e,t,n,r,i,s){var o,u=this.get("graphic"),a={type:"path",width:e,stroke:i,height:t,x:n,y:r};return s&&(a.fill=s),o=u.addShape(a),o.addClass("yui3-gridlines"),o},_stylePath:function(e,t,n,r,i,s,o){return e.set("width",t),e.set("height",n),e.set("stroke",s),e.set("x",r),e.set("y",i),o&&e.set("fill",o),e},_getPoints:function(e,t,n){var r,i=[],s,o=e-1;for(r=0;r<e;r+=1)s=r/o,i[r]={x:t*s,y:n*s};return i},_horizontalLine:function(e,t,n,r){var i=r.showFirst?0:1,s=r.showLast?t.length:t.length-1,o;for(;i<s;i+=1)o=t[i].y,e.moveTo(0,o),e.lineTo(n,o)},_verticalLine:function(e,t,n,r){var i=r.showFirst?0:1,s=r.showLast?t.length:t.length-1,o;for(;i<s;i+=1)o=t[i].x,e.moveTo(o,0),e.lineTo(o,n)},_horizontalFill:function(e,t,n,r,i,s){var o,u,a,f=t.length;for(o=r;o<f;o+=i)u=t[o].y,a=o<f-1?t[o+1].y:s,e.moveTo(0,u),e.lineTo(0,a),e.lineTo(n,a),e.lineTo(n,u),e.lineTo(0,u),e.closePath()},_verticalFill:function(e,t,n,r,i,s){var o,u,a,f=t.length;for(o=r;o<f;o+=i)u=t[o].x,a=o<f-1?t[o+1].x:s,e.moveTo(u,0),e.lineTo(a,0),e.lineTo(a,n),e.lineTo(u,n),e.lineTo(u,0),e.closePath()},_getDefaultStyles:function(){var e={line:{color:"#f0efe9",weight:1,alpha:1},fill:null,showFirst:!0,showLast:!0};return e}},{ATTRS:{x:{value:0},y:{value:0},direction:{},axis:{},graphic:{},count:{}}}),e.GridlinesCanvas=e.Base.create("gridlinesCanvas",e.Gridlines,[],{_path:null,remove:function(){var e=this._path,t=this.get("width"),n=this.get("height"),r;e&&(e.context.clearRect(0,0,t,n),r=e.canvas.parentNode,r&&r.
removeChild(e.canvas))},draw:function(e,t,n,r){this.get("axis")&&this._drawGridlines(e,t,n,r)},_endPath:function(e){e.fill&&(e.context.fillStyle=e.fill.color,e.context.closePath(),e.context.fill()),e.stroke&&(e.context.strokeStyle=e.stroke.color,e.context.lineWidth=e.stroke.weight,e.context.stroke())},_getPath:function(e,t,n,i,s,o){var u,a=this.get("node"),f=r.createElement("canvas"),l=f.getContext("2d");return f.width=e,f.height=t,f.style.position="absolute",f.style.left=n+"px",f.style.top=i+"px",f.className="yui3-gridlines",a&&a.appendChild(f),u={canvas:f,context:l},s&&(u.stroke=s),o&&o.color&&(u.fill=o),u},_stylePath:function(e,t,n,r,i,s,o){return e.canvas.width=t,e.canvas.height=n,e.canvas.style.position="absolute",e.canvas.style.left=r+"px",e.canvas.style.top=i+"px",s&&(e.stroke=s),o&&o.color&&(e.fill=o),e},_getPoints:function(e,t,n){var r,i=[],s,o=e-1;for(r=0;r<e;r+=1)s=r/o,i[r]={x:t*s,y:n*s};return i},_horizontalLine:function(e,t,n,r){var i=r.showFirst?0:1,s=r.showLast?t.length:t.length-1,o;for(;i<s;i+=1)o=t[i].y,e.context.moveTo(0,o),e.context.lineTo(n,o)},_verticalLine:function(e,t,n,r){var i=r.showFirst?0:1,s=r.showLast?t.length:t.length-1,o;for(;i<s;i+=1)o=t[i].x,e.context.moveTo(o,0),e.context.lineTo(o,n)},_horizontalFill:function(e,t,n,r,i,s){var o,u,a,f=t.length;for(o=r;o<f;o+=i)u=t[o].y,a=o<f-1?t[o+1].y:s,e.context.moveTo(0,u),e.context.lineTo(0,a),e.context.lineTo(n,a),e.context.lineTo(n,u),e.context.lineTo(0,u)},_verticalFill:function(e,t,n,r,i,s){var o,u,a,f=t.length;for(o=r;o<f;o+=i)u=t[o].x,a=o<f-1?t[o+1].x:s,e.context.moveTo(u,0),e.context.lineTo(a,0),e.context.lineTo(a,n),e.context.lineTo(u,n),e.context.lineTo(u,0)}},{ATTRS:{node:{},graphic:{lazyAdd:!1,setter:function(e){var t=e;return t&&(t._node&&(t=t._node),this.set("node",t)),e}}}}),o.prototype={init:function(t){var n,r,i,s=t.valueKeys,o=t.displayKeys,u,a,f,l=this.items||{},c;this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.dataProvider=t.dataProvider,this.contentDiv=e.DOM.create('<div style="position:absolute;top:'+t.y+"px;"+t.x+"0px;height: "+t.height+"px; width: "+t.width+'px;" class="l-hbox">'),this.dateLabelFunction=t.dateLabelFunction,this.dateLabelFormat=t.dateLabelFormat,this.dateLabelScope=t.dateLabelScope||this,t.render._node.appendChild(this.contentDiv),i=s.length,r=e.DOM.create('<ul  style="vertical-align: middle; line-height: '+this.height+'px;padding:0px 0px 0px 0px;margin:0px 0px 0px 0px;" class="layout-item-modules pure-g">'),this.contentDiv.appendChild(r),this.dateItem={li:e.DOM.create('<li class="layout-item-module pure-u" style="display:inline-block; margin: 0px 4px 0px 0px;">'),value:e.DOM.create('<span style="border-left:'+t.swatchWidth+"px solid #fff;font-size:"+t.fontSize+";font-family:"+t.font+';" id="dateitem";font-color:'+t.dateColor+'" ></span>')},this.dateItem.li.appendChild(this.dateItem.value),r.appendChild(this.dateItem.li);for(n=0;n<i;n+=1)f=s[n],u=o[n],a={},c=t.colors[f],a.li=e.DOM.create('<li id="'+f+'" class="layout-item-module pure-u" style="display:inline-block; margin: 0px 4px 0px 0px;">'),a.bullet=e.DOM.create('<div style="display: inline-block;width:3px; height: '+this.height+"px; background-color:"+c+';"></div>'),a.label=e.DOM.create('<span style="font-size:'+t.fontSize+";font-family:"+t.font+";color:"+c+';display:inline:margin: 0px 0px 0px 0px;" id="'+f+'" >'+t.delim+u+" : </span>"),a.value=e.DOM.create('<span style="font-size:'+t.fontSize+";font-family:"+t.font+';display:inline:margin: 0px 0px 0px 0px;" id="'+f+'Value" ></span>'),r.appendChild(a.li),a.li.appendChild(a.bullet),a.li.appendChild(a.label),a.li.appendChild(a.value),l[f]=a,a.li.style.display="none";this.list=r,this.seriesQueue=s,this.items=l,this.priceUpColor=t.priceUpColor,this.priceDownColor=t.priceDownColor,this.valueLabelFormat=t.valueLabelFormat,this.formatDate=t.formatDate,this._xy=e.DOM.getXY(this.contentDiv)},destroy:function(){this._removeChildren(this.list),this._removeChildren(this.contentDiv),this.contentDiv&&this.contentDiv.parentNode&&this.contentDiv.parentNode.removeChild(this.contentDiv)},_removeChildren:function(e){if(e&&e.hasChildNodes()){var t;while(e.firstChild)t=e.firstChild,this._removeChildren(t),e.removeChild(t)}},update:function(e,t){this._dataItem=e.dataProvider[e.dataIndex],t&&this.redraw()},redraw:function(){var t=this.seriesQueue,n,r=t.length,i,s=this.items,o,u,a=this.dateLabelFunction,f=this.dateLabelScope,l=this.dateLabelFormat,c,h=this._dataItem;if(h){u=h.Date||h.Timestamp,a&&(c=[u],l&&c.push(l),u=a.apply(f,c)),this.dateItem.value.innerHTML=e.Escape.html(u);for(o=0;o<r;o+=1)n=t[o],i=s[n],h.hasOwnProperty(n)?(i.li.style.display="inline-block",u=h[n],i.value.innerHTML=e.Number.format(parseFloat(u),this.valueLabelFormat),i.value.style.color=u>0?this.priceUpColor:this.priceDownColor):i.li.style.display="none";h=this._dataItem=null}}},e.StockIndicatorsLegend=o,e.StockIndicatorsAxisLegend=function(){this.initializer.apply(this,arguments)},e.StockIndicatorsAxisLegend.prototype={initializer:function(e){var t=e.axis,n,r=this._getDefaultStyles(),i;for(n in e.styles)e.styles.hasOwnProperty(n)&&(r[n]=e.styles[n]);this._y=e.y,this._contentBox=e.render,this._styles=r,this._maximum=t.get("maximum"),this._minimum=t.get("minimum"),this._dataProvider=e.dataProvider,this._axis=t,this._labelFormat=e.labelFormat||t.get("labelFormat"),this._labelFunction=e.labelFunction||t.get("labelFunction"),this.height=e.height||t.get("height"),this._labels=[],i=this._getDimensions(),this.width=i.width,this.itemWidth=this.width,this.itemHeight=i.height,this._contentWidth=e.contentWidth,this._contentHeight=e.contentHeight;for(n in i.arrow)i.arrow.hasOwnProperty(n)&&(this._styles.arrow[n]=i.arrow[n]);this._biggestText=i.biggestText,this._createIndicators(e)},_createIndicators:function(e){var t=e.previousClose,n=e.indicatorItems,r=e.interactiveItem;t&&(this._previousClose=this._getPreviousClose(t)),n&&(this._indicatorItems=this._initializeIndicatorItems(n)),r&&(this._interactiveItem=this._getInteractiveItem
(r))},_getDimensions:function(){var t=this._styles,n=t.label,i=t.arrow,s,o=this._axis,u=r.createElement("span"),a=r.createElement("span"),f,l,c=this._labelFunction(this._minimum,this._labelFormat),h=this._labelFunction(this._maximum,this._labelFormat),p=r.createElement("div"),d=r.createElement("span"),v,m,g,y,b,w,E;for(v in n)n.hasOwnProperty(v)&&(a.style[v]=n[v],u.style[v]=n[v]);if(i)for(v in i)i.hasOwnProperty(v)&&(d.style[v]=i[v]);return a.appendChild(r.createTextNode(c)),u.appendChild(r.createTextNode(h)),this._contentBox.appendChild(p),p.style.position="absolute",p.appendChild(u),p.appendChild(a),y=parseFloat(u.offsetWidth),g=parseFloat(a.offsetWidth),f=Math.max(parseFloat(u.offsetHeight),parseFloat(a.offsetHeight)),y>=g?(o._removeChildren(a),e.Event.purgeElement(a,!0),a.parentNode.removeChild(a),l=y,m=h):(o._removeChildren(u),e.Event.purgeElement(u,!0),u.parentNode.removeChild(u),l=g,m=c),l=Math.max(parseFloat(u.offsetWidth),parseFloat(a.offsetWidth)),E=f/13*7+"px",b=parseFloat(E)+"px",w=b,d.style.borderRightWidth=E,d.style.borderTopWidth=b,d.style.borderBottomWidth=w,p.appendChild(d),s=parseFloat(d.offsetWidth),l+=s,o._removeChildren(p),e.Event.purgeElement(p,!0),p.parentNode.removeChild(p),{width:l,height:f,arrow:{borderRightWidth:E,borderBottomWidth:w,borderTopWidth:b,width:s},biggestText:m}},_getPreviousClose:function(e){var t="stockIndicatorsPreviousClose",n=this._axis,i=this._styles,s=i.label,o=i.arrow,u=u,a=e.background,f=e.value,l=r.createElement("div"),c=r.createElement("span"),h=r.createElement("span"),p,d=this._labelFunction(f,this._labelFormat),v=e.ycoord||n._getCoordFromValue(this._minimum,this._maximum,this.height,f,this.height,!0);v+=this._y,h.id=e.id||t,e.className&&(t=t+" "+e.className),h.className=t;if(s)for(p in s)s.hasOwnProperty(p)&&(h.style[p]=s[p]);if(o)for(p in o)o.hasOwnProperty(p)&&(c.style[p]=o[p]);return a&&(h.style.background=a,c.style.borderRightColor=a),l.style.position="absolute",h.appendChild(r.createTextNode(d)),this._contentBox.appendChild(l),l.appendChild(c),l.appendChild(h),l.style.left=this._contentWidth-this.itemWidth+"px",l.style.top=v-this.itemHeight/2+"px",e.node=l,e.textNode=h,this._labels.push(l),e},_getInteractiveItem:function(e){var t="stockIndicatorsInteractiveItem",n=this._styles,i=n.label,s=n.arrow,o=o,u=e.background,a=r.createElement("div"),f=r.createElement("span"),l=r.createElement("span"),c;l.id=e.id||t,e.className&&(t=t+" "+e.className),l.className=t;if(i)for(c in i)i.hasOwnProperty(c)&&(l.style[c]=i[c]);if(s)for(c in s)s.hasOwnProperty(c)&&(f.style[c]=s[c]);return u&&(l.style.background=u,f.style.borderRightColor=u),a.style.position="absolute",this._contentBox.appendChild(a),a.appendChild(f),a.style.left=this._contentWidth-this.itemWidth+"px",a.style.top=0-this.itemHeight/2+"px",a.appendChild(l),a.style.visibility="hidden",e.node=a,e.label=l,this._labels.push(a),e},_initializeIndicatorItems:function(t){var n="stockIndicatorsIndicatorLabel",i=this._styles,s=i.label,o=i.arrow,u=this._axis,a,f,l,c,h,p,d,v=this._dataProvider,m,g,y,b,w=this._contentBox._node;for(a in t)if(t.hasOwnProperty(a)){m=v.length-1;while(!e.Lang.isNumber(v[m][a]))m-=1;g=v[m][a],l=t[a],c=r.createElement("div"),h=r.createElement("span"),p=r.createElement("span"),p.id=l.id||n+"_"+a,p.className=l.className?n+" "+l.className:n,d=l.background;if(s)for(f in s)s.hasOwnProperty(f)&&(p.style[f]=s[f]);if(o)for(f in o)o.hasOwnProperty(f)&&(h.style[f]=o[f]);d&&(e.Lang.isArray(d)&&(a==="close"&&l.range==="1d"?d=g<this._previousClose.value&&d.length>1?d[1]:d[0]:d=d[0]),p.style.background=d,h.style.borderRightColor=d),b=this._labelFunction(g,this._labelFormat),y=this._y+u._getCoordFromValue(this._minimum,this._maximum,this.height,g,this.height,!0),p.appendChild(r.createTextNode(b)),c.style.position="absolute",c.style.left=this._contentWidth-this.itemWidth+"px",c.style.top=y-this.itemHeight/2+"px",w.appendChild(c),c.appendChild(h),c.appendChild(p),this._labels.push(c),l.node=c,l.label=p,this._labels.push(c)}return t},update:function(t){var n=this._interactiveItem;this._dataItem=t.dataProvider[t.dataIndex],this._dataItem&&(n.value=this._dataItem[n.key],n.ycoord=this._y+this._axis._getCoordFromValue(this._minimum,this._maximum,this.height,n.value,this.height,!0)),isNaN(n.value)?n.node.style.visibility="hidden":(n.node.style.visibility="visible",n.label.innerHTML=e.Escape.html(this._labelFunction(n.value,this._labelFormat)),r.createElementNS?e.DOM.setStyle(n.node,"transform","translateY("+n.ycoord+"px)"):n.node.style.top=n.ycoord-this.itemHeight/2+"px")},redraw:function(){},_getDefaultStyles:function(){return{arrow:{borderTopColor:"transparent",display:"inline-block",borderBottomColor:"transparent",borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",height:"0px",width:"0px"},previousClose:{color:"#eee"},label:{display:"inline-block",whiteSpace:"nowrap",position:"absolute",backgroundColor:"#9aa",color:"#fff",fontFamily:"Helvetica Neue, Helvetica, Arial",fontWeight:"bold",fontSize:"10pt",paddingLeft:"3pt",paddingRight:"3pt",borderTopRightRadius:"10% 10%",borderBottomRightRadius:"10% 10%"}}},destroy:function(){var t=this._labels,n;while(t&&t.length>0)n=t.pop(),this._axis._removeChildren(n),e.Event.purgeElement(n,!0),n.parentNode&&n.parentNode.removeChild(n)}},e.StockIndicatorsCanvasAxisLegend=function(){this.initializer.apply(this,arguments)},e.extend(e.StockIndicatorsCanvasAxisLegend,e.StockIndicatorsAxisLegend,{_createIndicators:function(e){var t=e.previousClose,n=e.indicatorItems,i=e.interactiveItem,s=this._styles,o=s.label,u=r.createElement("canvas");u.width=this._contentWidth,u.height=this._contentHeight,u.style.left="0px",u.style.top="0px",u.style.position="absolute",this._context=u.getContext("2d"),this._contentBox.appendChild(u),this._canvas=u,this._context.font=o.fontSize+" "+o.fontFamily.toString()+" "+o.fontWeight,this._maxTextMetrics=this._context.measureText(this._biggestText),t&&(this._previousClose=this._getPreviousClose(t)),n&&(this._indicatorItems=
this._initializeIndicatorItems(n)),i&&(this._interactiveItem=this._getInteractiveItem(i))},_getPreviousClose:function(e){var t=this._styles,n=t.label,r=t.arrow,i=i,s=e.background,o=e.value,u=r.width;return this._drawIndicator(this._context,o,n,u,s),e},_getInteractiveItem:function(e){var t=r.createElement("canvas");return t.width=this._contentWidth,t.height=this.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",this._interactiveContext=t.getContext("2d"),this._contentBox.appendChild(t),this._interactiveCanvas=t,e.canvas=t,e},_initializeIndicatorItems:function(t){var n=this._styles,r=n.label,i=n.arrow,s,o,u,a=this._dataProvider,f,l,c=i.width;for(s in t)if(t.hasOwnProperty(s)){f=a.length-1;while(!e.Lang.isNumber(a[f][s]))f-=1;l=a[f][s],o=t[s],u=o.background,u&&e.Lang.isArray(u)&&(s==="close"&&o.range==="1d"?u=l<this._previousClose.value&&u.length>1?u[1]:u[0]:u=u[0]),this._drawIndicator(this._context,l,r,c,u)}return t},_drawIndicator:function(e,t,n,r,i){var s=this._axis,o=this._labelFunction.apply(this,[t,this._labelFormat]),u=this._y+s._getCoordFromValue(this._minimum,this._maximum,this.height,t,this.height,!0),a,f,l=this._contentWidth-this.itemWidth,c=u-this.itemHeight/2,h=l+r,p,d=c+this.itemHeight,v,m=this.itemHeight/10;e.font=n.fontSize+" "+n.fontFamily.toString()+" "+n.fontWeight,a=e.measureText(o),f=this.itemWidth-r-(this._maxTextMetrics.width-a.width),p=h+f,v=f/10,e.beginPath(),e.fillStyle=i,e.moveTo(h,c),e.lineTo(l,c+this.itemHeight/2),e.lineTo(h,d),e.lineTo(p-v,d),e.quadraticCurveTo(p,d,p,d-m),e.lineTo(p,c+m),e.quadraticCurveTo(p,c,p-v,c),e.lineTo(h,c),e.closePath(),e.fill(),e.fillStyle=n.color,e.font=n.fontSize+" "+n.fontFamily.toString()+" "+n.fontWeight,a=this._context.measureText(o),e.fillText(o,l+r+(f/2-a.width/2),c+this.itemHeight*3/4)},update:function(e){var t=this._interactiveItem,n=this._styles,r=n.label,i=n.arrow.width;this._dataItem=e.dataProvider[e.dataIndex],this._dataItem&&(t.value=this._dataItem[t.key]),isNaN(t.value)||(this._interactiveContext.clearRect(0,0,this._contentWidth,this.height),this._drawIndicator(this._interactiveContext,t.value,r,i,t.background))},destroy:function(){var t,n=this._canvas,r=this._context;r&&r.clearRect(0,0,this._contentWidth,this._contentHeight),n&&(e.Event.purgeElement(n,!0),t=n.parentNode,t.removeChild(n)),n=this._interactiveCanvas,r=this._interactiveContext,r&&r.clearRect(0,0,this._contentWidth,this._contentHeight),n&&(e.Event.purgeElement(n,!0),t=n.parentNode,t.removeChild(n))}}),e.StockIndicatorsPrinter=function(){this._init.apply(this,arguments)},e.StockIndicatorsPrinter.NAME="stockIndicatorsPrinter",e.StockIndicatorsPrinter.prototype={_axesClassMap:{numeric:e.NumericCanvasAxis,category:e.CategoryCanvasAxis,intraday:e.IntradayCanvasAxis},_graphClassMap:{thresholdline:e.ThresholdCanvasLineSeries,multipleline:e.MultipleLineCanvasSeries,volumecolumn:e.VolumeColumnCanvas,candlestick:e.CanvasCandlestickSeries,ohlc:e.CanvasOHLCSeries,line:e.CanvasLineSeries,area:e.CanvasAreaSeries,combo:e.CanvasComboSeries,marker:e.CanvasMarkerSeries,column:e.CanvasColumnSeries},_init:function(e,t,n){this._width=t,this._height=n,this._charts=e},getDataURI:function(){var e=this.getChartCanvas();return e.toDataURL()},getChartCanvas:function(){var e=this._charts,t,n,i=e.length,s=r.createElement("canvas"),o=s.getContext("2d"),u=[],a=[],f=[],l=[],c=[],h,p,d,v;s.width=this._width,s.height=this._height;for(n=0;n<i;n+=1)t=e[n],u.push(t.gridlinesConfig),a.push(t.axesConfig),f.push(t.seriesCollection),c.push(t.legendConfig),l.push({x:t.graphX,y:t.graphY,width:t.graphWidth,height:t.graphHeight});return h=this._getAxes(a),p=this._getGridlines(u,h),d=this._getLegends(c),v=this._getGraphs(f,l),s=this._printItems(h,p,d,v,s,o,i),this._destroyItems(h,p,d,v),s},_printItems:function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;for(u=0;u<o;u+=1)l=e[u],p=t[u],d=n[u],c=l.date,h=l.numeric,p&&(w=p.horizontal,E=p.vertical,w&&s.drawImage(w._path.canvas,w.get("x"),w.get("y")),E&&s.drawImage(E._path.canvas,E.get("x"),w.get("y"))),l&&(c&&s.drawImage(c._path,c.get("x")-c._xOffset,c.get("y")-c._yOffset),h&&s.drawImage(h._path,h.get("x")-h._xOffset,h.get("y")-h._yOffset)),d&&s.drawImage(d._canvas,0,0);o=r.length;for(u=0;u<o;u+=1){v=r[u];if(v){m=v.get("x"),g=v.get("y");if(v._paths){f=v._paths.length,y=v.get("width"),b=v.get("height");for(a=0;a<f;a+=1)s.drawImage(v._paths[a].canvas,m,g,y,b)}}}return i},_destroyItems:function(e,t,n,r){var i,s=e.length,o,u,a,f,l,c,h,p;for(i=0;i<s;i+=1)f=e[i],c=f.numeric,l=f.date,c&&c.destroy(),l&&l.destroy();s=t.length;for(i=0;i<s;i+=1)o=t[i],u=o.horizontal,a=o.vertical,u&&u.remove(),a&&a.remove();s=r.length;for(i=0;i<s;i+=1)h=r[i],h&&h.destroy();s=n.length;for(i=0;i<s;i+=1)p=n[i],p&&p.destroy()},_getAxes:function(e){var t,n=e.length,r=[],i,s,o,u;for(t=0;t<n;t+=1)o=e[t],u=this._axesClassMap[o.date.type],i=new u(o.date),i._drawAxis(),u=this._axesClassMap[o.numeric.type],s=new u(o.numeric),s._drawAxis(),r.push({date:i,numeric:s});return r},_getGridlines:function(t,n){var r,i,s,o,u,a,f,l,c=t.length,h=[];for(a=0;a<c;a+=1)u=t[a],r=u.horizontal,i=u.vertical,r.axis=n[a].numeric,i.axis=n[a].date,s=new e.GridlinesCanvas(r),f=r.width,l=r.height,s.draw(f,l),o=new e.GridlinesCanvas(i),f=i.width,l=i.height,o.draw(f,l),h.push({horizontal:s,vertical:o});return h},_getLegends:function(t){var n,r=[],i,s=t.length,o;for(i=0;i<s;i+=1)o=t[i],o.type==="axis"&&(n=new e.StockIndicatorsCanvasAxisLegend(o),r.push(n));return r},_getGraphs:function(t,n){var r,i,s,o,u=t.length,a,f,l,c,h=[];for(r=0;r<u;r+=1){o=t[r],s=o.length;for(i=0;i<s;i+=1)a=o[i],l=n[r],a.x=l.x,a.y=l.y,a.width=l.width,a.height=l.height,c=this._graphClassMap[a.type],c&&(a.graphic=e.Node.create("<div>"),f=new c(a),f.set("width",a.width),f.set("height",a.height),f.draw(),h.push(f))}return h}},e.StockIndicatorsChart=e.Base.create("stockIndicatorsChart",e.Widget,[e.Renderer],{initializer:function(){var e=this.get("contentBox");e._node.style.position="relative",this._axes=[],this._graphs=[],this._graphics=
[],this._crosshairs=[],this._hotspots=[],this._legends=[],this._runTimeline=!1,this._onEnterFrame=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||n.msRequestAnimationFrame,this._autoDraw=this._onEnterFrame?!1:!0},bindUI:function(){this._addEvents()},_addEvents:function(){var t=n&&"ontouchstart"in n&&!(e.UA.chrome&&e.UA.chrome<6),r=".yui3-hotspot";t?(this._startHandle=e.on("touchstart",e.bind(this._eventDispatcher,this),r),this._moveHandle=e.on("touchmove",e.bind(this._eventDispatcher,this),r),this._endHandle=e.on("touchend",e.bind(this._eventDispatcher,this),r)):(this._startHandle=e.on("mouseenter",e.bind(this._eventDispatcher,this),r),this._moveHandle=e.on("mousemove",e.bind(this._eventDispatcher,this),r),this._endHandle=e.on("mouseleave",e.bind(this._eventDispatcher,this),r))},drawCharts:function(){var t=[],n=this.get("charts"),i=this.get("contentBox"),s,o=n.length,u=r.createElement("canvas");this._removeAll();for(s=0;s<o;s+=1)t[s]=this.drawChart(n[s],i);this._charts=t,this._addEvents(),u&&u.getContext("2d")&&(this._printStockIndicators=new e.StockIndicatorsPrinter(t,this.get("width"),this.get("height")))},getDataURI:function(){var e;return this._printStockIndicators&&(e=this._printStockIndicators.getDataURI()),e},getChartCanvas:function(){var e;return this._printStockIndicators&&(e=this._printStockIndicators.getChartCanvas()),e},_eventDispatcher:function(e){var t=e.type,n=e&&e.hasOwnProperty("changedTouches"),r=n?e.changedTouches[0].pageX:e.pageX,i=n?e.changedTouches[0].pageY:e.pageY;t==="mouseenter"||t==="touchstart"?this.startTimeline():(t==="mouseleave"||t==="touchend")&&this.stopTimeline(),e.halt(),this.fire("chartEvent:"+t,{originEvent:e,pageX:r,pageY:i,isTouch:n})},updatesLegendsCrosshair:function(e){var t=this._charts,n,r,i=t.length,s=e.pageX,o=e.pageY,u,a=this._dataProvider,f,l,c,h;if(s%1===0&&o%1===0&&this.curX!==s)for(h=0;h<i;h+=1)u=t[h],l=u.xy,c=s-l[0],f=Math.floor(c/u.graphWidth*a.length),n=u.crosshair,r=u.legend,n&&n.setTarget(s,this._autoDraw),r&&r.update({dataProvider:a,dataIndex:f,pageX:s,pageY:o},this._autoDraw);this.curX=s},startTimeline:function(){this._runTimeline||(this._runTimeline=!0,this._timelineStart=+(new Date)-17,this.redraw())},stopTimeline:function(){var e,t=this._timelineId;this._runTimeline=!1,t&&(e=[t],this._timelineId=null)},redraw:function(){var e=this,t,r,i=this._charts,s,o,u=i.length,a=+(new Date);if(a>=this._timelineStart+17){for(o=0;o<u;o+=1)s=i[o],t=s.crosshair,r=s.legend,t&&t.redraw(),r&&r.redraw();this._timelineStart=+(new Date)}this._runTimeline&&!this._autoDraw&&(this._timelineId=this._onEnterFrame.apply(n,[function(){e.redraw()}]))},_graphMap:{ohlc:e.OHLCSeries,area:e.AreaSeries,line:e.LineSeries,combo:e.ComboSeries,marker:e.MarkerSeries,column:e.ColumnSeries,candlestick:e.CandlestickSeries,multipleline:e.MultipleLineSeries,volumecolumn:e.VolumeColumn,thresholdline:e.ThresholdLineSeries},_getGraph:function(e){return this._graphMap[e]},_getSeriesCollection:function(t){var n=[],r,i,s=t.indicators,o,u,a=s.length,f,l,c,h,p={candlestick:!0,line:!0,ohlc:!0,volumecolumn:!0,multipleline:!0};for(u=0;u<a;u+=1){i=s[u],c=i.valueKey,o=i.type;if(o==="candlestick"||o==="ohlc"||typeof c=="string")h=!p[o]&&i.groupMarkers,r={groupMarkers:h,type:i.type,xKey:t.categoryKey,yKey:i.valueKey},n.push(r);else{l=c.length;for(f=0;f<l;f+=1)o=i.type,r={xKey:t.categoryKey,yKey:i.valueKey[f]},typeof o=="string"?(r.groupMarkers=!p[o]&&i.groupMarkers,r.type=o):(r.groupMarkers=!p[o]&&i.groupMarkers,r.type=o[f],o[f]==="multipleline"&&t.threshold&&t.range==="1d"?r.thresholds=[parseFloat(i.previousClose)]:o[f]==="volumecolumn"&&(r.previousClose=parseFloat(i.previousClose),r.yAxis=new e.NumericAxisBase(i.yAxis),r.drawInBackground=!0)),r.drawInBackground?n.unshift(r):n.push(r)}}return n},_getSeriesStyles:function(e,t){var n,r=t.colors,i,s,o,u,a,f=e.length;for(a=0;a<f;a+=1){n=e[a];switch(n.type){case"volumecolumn":n.styles={upPath:{fill:{color:r.volumeColumnUp}},downPath:{fill:{color:r.volumeColumnDown}},padding:{top:200}};break;case"line":n.styles={line:{weight:t.lineWidth,color:r[n.yKey]}};break;case"combo":n.styles={line:{weight:t.lineWidth,color:r[n.yKey].line},area:{color:r[n.yKey].area}},n.showMarkers=!1,n.showAreaFill=!0;break;case"multipleline":n.styles={weight:t.lineWidth,color:t.range==="1d"?[r.quoteLineUp,r.quoteLineDown]:[r.quoteLine],thresholds:t.threshold};break;case"candlestick":case"ohlc":n.styles={upcandle:{fill:{color:r.priceUp}},downcandle:{fill:{color:r.priceDown}}};break;case"marker":o=this.get("dataProvider"),i=Math.min(t.dotDiameter,t.width/o.length),n.styles={marker:{width:i,height:i,border:{color:r[n.yKey],weight:0},fill:{color:r[n.yKey]}}};break;case"column":o=this.get("dataProvider"),u=t.rangeType,s=t.width/o.length,s=Math.min(10,Math.round(s-s*.4)),s-=2,s=Math.max(1,s),n.styles={marker:{width:s,border:{weight:0},fill:{color:r[n.yKey]}}}}}return e},_drawGraphs:function(e,t,n){var r,i,s,o={},u=t.date,a=t.numeric,f,l,c=e.length;for(l=0;l<c;l+=1)r=e[l],r.xAxis=u,r.yAxis||(r.yAxis=a),r.graphic=n,f=this._getGraph(r.type),s=new f(r),s.draw(),i=r.yKey,typeof i!="string"&&(i="quote"),o[i]=s,this._graphs.push(s);return o},_drawGridlines:function(t,n,r,i){var s,o;return t&&(s=new e.Gridlines({graphic:i,direction:t.direction,axis:r.numeric,x:t.x,y:t.y,styles:t})),n&&(o=new e.Gridlines({graphic:i,direction:n.direction,axis:r.date,styles:n})),s.draw(t.width,t.height),o.draw(n.width,n.height),{horizontal:s,vertical:o}},_axesClassMap:{numeric:e.NumericAxis,numericbase:e.NumericAxisBase,category:e.CategoryAxis,categorybase:e.CategoryAxisBase,intraday:e.IntradayAxis},_drawAxes:function(e,t){var n,r,i,s,o=this._axesClassMap[t.type],u=this._axesClassMap[e.type];return i=new o(t),s=new u(e),r=s.get("boundingBox"),r._node.style.left=0,r._node.style.top=e.y+"px",r=i.get("boundingBox"),r._node.style.left=t.x+"px",r._node.style.top=t.y+"px",n={numeric:i,date:s},this._axes.push(n),n},_getAxesConfigs:function(e,t){var n={},r={},i,s=e.axes.numeric
,o=e.axes.date;for(i in s)s.hasOwnProperty(i)&&(n[i]=s[i]);for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);return n.y=t.y,n.x=e.width-s.width,n.height=t.height,n.styles.margin=t.margin,r.x=t.x,r.y=e.y+e.height-o.height,r.width=t.width,r.styles.margin=t.margin,{date:r,numeric:n}},_drawHotspot:function(t,n){var r=e.Node.create('<div class="yui3-hotspot" id="fincharthotspot_'+this._hotspots.length+'" style="width:'+t.width+"px;height:"+t.height+"px;position:absolute;left:"+t.x+"px;top:"+t.y+'px;opacity:0;background:#fff;z-index:4"></div>');r.setStyle("opacity",0),n.append(r),this._hotspots.push(r)},_createGraphic:function(t,n){var r=new e.Graphic({render:n,width:t.width,height:t.height,x:t.x,y:t.y,autoDraw:!1});return this._graphics.push(r),r},_getGraphicDimensions:function(e,t){var n,r=e.axes.numeric.width,i=e.axes.date.height,s=e.axes.numeric.position,o=e.axes.date.position,u,a,f=e.width,l=e.height,c;n=e[t]?this._copyObject(e[t]):{},u=n.x||0,a=n.y||e.y,c=n.margin,c&&(c.top&&(a+=c.top,l-=c.top),c.left&&(u+=c.left,f-=c.left),c.bottom&&(l-=c.bottom),c.right&&(f-=c.right)),e.legend&&e.legend.type!=="axis"&&(a+=e.legend.height,l-=e.legend.height);if(!n||!n.overlapXAxis)l-=i,o==="top"&&(a+=i);if(!n||!n.overlapYAxis)f-=r,s==="left"&&(u+=r);return n.width=f,n.height=l,n.x=u,n.y=a,n},_addCrosshair:function(t,n,r,i){var s,o={stroke:{color:t.lineColor,weight:t.lineWidth}},u=[],a,f=t.drawHorizontal,l,c,h,p,d=e.Array.hash(t.keys);for(c in r)r.hasOwnProperty(c)&&(p=c==="quote"?"close":c,l=r[c],h=n[p],h&&typeof h=="object"&&l.get("type")==="combo"&&(h=h.line),d[p]&&(a={marker:{shape:"circle",width:t.dotDiameter,height:t.dotDiameter,fill:{color:t.color?t.color:h},stroke:{weight:0}},coords:c==="quote"?l.get("ycoords").close:l.get("ycoords")},f&&(a.line={stroke:{color:t.color?t.color:h}}),u.push(a),o.coords=l.get("xcoords")));return u.length>0&&(s=new e.Crosshair({width:t.width,height:t.height,x:t.x,y:t.y,graphX:t.graphX,graphY:t.graphY,render:i,series:u,category:o}),this._crosshairs.push(s)),s},_legendMap:{basic:e.StockIndicatorsLegend,axis:e.StockIndicatorsAxisLegend},_addLegend:function(e,t){var n,r=e.legend,i=this._legendMap[r.type];return r.colors=e.colors,r.render=t,i&&(n=new i(r),this._legends.push(n)),n},_getGridlinesDimensions:function(e,t){return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)}},_getGridlinesConfig:function(e,t){var n,r;return e&&(n={direction:"horizontal",x:e.x,y:e.y,width:e.width,height:e.height,styles:e}),t&&(r={direction:"vertical",styles:t,width:t.width,height:t.height,x:t.x,y:t.y}),{horizontal:n,vertical:r}},drawChart:function(t,n){var r,i,s,o,u,a,f,l,c,h=this._getGraphicDimensions(t,"graphs"),p,d,v,m=t.threshold,g,y=parseFloat(t.previousClose),b,w;return t.horizontalGridlines.y=h.y,t.verticalGridlines.x=h.x,p=this._getAxesConfigs(t,h),i=this._drawAxes(p.date,p.numeric,n),i.numeric.render(n),i.date.render(n),v=this._getGridlinesConfig(this._getGraphicDimensions(t,"horizontalGridlines"),this._getGraphicDimensions(t,"verticalGridlines")),o=this._createGraphic(this._getGridlinesDimensions(v.horizontal,v.vertical),n),s=this._createGraphic(h,n),u=this._drawGridlines(v.horizontal,v.vertical,i,o),b=this._getSeriesStyles(this._getSeriesCollection(t),t),a=this._drawGraphs(b,i,s),f=this._drawHotspot(h,n),d=this._mergeStyles(this._getGraphicDimensions(t,"crosshair"),t.crosshair),d.graphX=h.x,d.graphY=h.y,l=this._addCrosshair(d,t.colors,a,n),t.legend.type==="axis"?(t.legend.axis=i.numeric,t.legend.y=h.y,t.legend.contentWidth=this.get("width"),t.legend.contentHeight=h.height+p.date.height):(t.legend.x=h.x,t.legend.y=t.y,t.legend.width=h.width),c=this._addLegend(t,n),m&&typeof y=="number"&&isFinite(y)&&(w={type:"thresholdline",thresholds:[y],graphic:s,yAxis:i.numeric,xAxis:i.date,styles:{thresholds:m}},g=new e.ThresholdLineSeries(w),b.push(w)),r={axes:i,graphic:s,gridlines:u,graphs:a,hotspot:f,crosshair:l,legend:c,xy:s.getXY(),axesConfig:p,gridlinesConfig:v,graphWidth:h.width,graphHeight:h.height,graphX:h.x,graphY:h.y,legendConfig:t.legend,seriesCollection:b,thresholds:g},s._redraw(),o._redraw(),r},_destroyCrosshairs:function(){var e,t=this._charts.length,n;while(this._crosshairs.length>0)n=this._crosshairs.pop(),n&&n.destroy();for(e=0;e<t;e+=1)delete this._charts[e].crosshair},_destroyHotspots:function(){var e,t=this._charts.length,n;while(this._hotspots.length>0)n=this._hotspots.pop(),n.empty(),n.remove(!0);for(e=0;e<t;e+=1)delete this._charts[e].hotspot},_destroyAxes:function(){var e,t=this._charts.length,n;while(this._axes.length>0)n=this._axes.pop(),n.date.destroy(!0),n.numeric.destroy(!0);for(e=0;e<t;e+=1)delete this._charts[e].axes},_destroyGraphs:function(){var e,t=this._charts.length,n;while(this._graphs.length>0)n=this._graphs.pop(),n.destroy(!0);for(e=0;e<t;e+=1)delete this._charts[e].graph},_destroyLegends:function(){var e,t=this._charts.length,n;while(this._legends.length>0)n=this._legends.pop(),n.destroy();for(e=0;e<t;e+=1)delete this._charts[e].legend},_destroyGraphics:function(){var e,t=this._charts.length,n;while(this._graphics.length>0)n=this._graphics.pop(),n.destroy();for(e=0;e<t;e+=1)delete this._charts[e].graphic},_removeAll:function(){var e,t;if(this._charts){this._destroyCrosshairs(),this._destroyHotspots(),this._destroyLegends(),this._destroyGraphs(),this._destroyAxes(),this._destroyGraphics();while(this._charts.length>0){e=this._charts.pop();for(t in e)e.hasOwnProperty(t)&&delete e[t]}}this._startHandle.detach(),this._moveHandle.detach(),this._endHandle.detach()},destructor:function(){this._removeAll()}},{ATTRS:{charts:{},dataProvider:{lazyAdd:!1,getter:function(){return this._dataProvider},setter:function(e){return this._dataProvider=e,e}}}}),e.StockIndicatorsSpark=function(){return this._init.apply(this,arguments),this},e.StockIndicatorsSpark.prototype={_graphMap:{line:e.LineSeries,marker:e.MarkerSeries,column:e.ColumnSeries,area:e.AreaSeries},_styleMap:{line:"line",marker:"marker",column:"marker",area:"area"
},_init:function(t){var n=t.styles,r=document.createElement("div"),i=document.createElement("div"),s=t.render,o=t.type||"line",u=o==="column"?"marker":o,a=this._graphMap[o];this.dataProvider=t.dataProvider,this.xKey=t.xKey,this.yKey=t.yKey,n||(n={},t[u]?n[u]=t[u]:(n[u]={},t.color&&(n.line.color=t.color),t.alpha&&(n.line.alpha=t.alpha),o==="line"&&(n.line.weight=isNaN(t.weight)?1:t.weight))),this.xAxis=new e.CategoryAxisBase({dataProvider:this.dataProvider,keys:[this.xKey]}),this.yAxis=new e.NumericAxisBase({dataProvider:this.dataProvider,keys:[this.yKey],alwaysShowZero:!1}),r.style.position="absolute",e.DOM.setStyle(r,"inlineBlock"),i.style.position="relative",s=document.getElementById(s),s.appendChild(r),r.appendChild(i),i.style.width=e.DOM.getComputedStyle(s,"width"),i.style.height=e.DOM.getComputedStyle(s,"height"),this.graphic=new e.Graphic({render:i,autoDraw:!1}),this.graph=new a({rendered:!0,dataProvider:t.dataProvider,graphic:this.graphic,styles:n,xAxis:this.xAxis,yAxis:this.yAxis,xKey:this.xKey,yKey:this.yKey}),this.contentBox=i,this.boundingBox=r,this.graph.validate(),this.graphic._redraw()},destroy:function(){var e;this.xAxis&&this.xAxis.destroy(!0),this.yAxis&&this.yAxis.destroy(!0),this.graph&&this.graph.destroy(),this.graphic&&this.graphic.destroy(),this.contentBox&&(e=this.contentBox.parentNode,e&&e.removeChild(this.contentBox)),this.boundingBox&&(e=this.boundingBox.parentNode,e&&e.removeChild(this.boundingBox))}}},"@VERSION@",{requires:["escape","graphics-group","axis-numeric","axis-category","series-line","series-marker","series-column","series-candlestick","series-ohlc","series-area","series-combo"]});
